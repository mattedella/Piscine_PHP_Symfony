{% extends 'base.html.twig' %}

{% block title %}{{ project.name }}{% endblock %}

{% block body %}
<div class="user_info" style="display: flex; flex-direction: column; align-items: center; justify-content: center; margin-top: 50px; gap: 20px; width:40%">
    <h1>{{ project.name }}</h1>

    <p><strong>Description:</strong> {{ project.description }}</p>
    <p><strong>XP:</strong> {{ project.xp }}</p>
    <p><strong>Estimated Time:</strong> {{ project.estimatedTimeInHours }} hours</p>

    {% set registeredParticipants = project.getUserProjects()|filter(up => not up.validated) %}
    {% set completedParticipants = project.getUserProjects()|filter(up => up.validated) %}

    <p><strong>Registered Participants:</strong> {{ registeredParticipants|length }}</p>
    <p><strong>Completed</strong> {{ completedParticipants|length }} times <strong>so far.</strong></p>


    {% if app.user %}
        {% if userProject is defined and userProject %}
            {% if not userProject.validated %}
                <form action="{{ path('project_unregister', { id: project.id }) }}" method="post">
                    <button type="submit">Unregister</button>
                </form>

                <div style="margin-top: 1rem;">
                    <a href="{{ path('chat_project', { projectId: project.id }) }}" class="btn btn-primary">
                        ðŸ’¬ Chat Progetto
                    </a>
                </div>

                <h3>Upload your project file</h3>
                <form action="{{ path('project_upload', { id: project.id }) }}" method="post" enctype="multipart/form-data">
                    <input type="file" name="project_file" required />
                    <button type="submit">Submit for Evaluation</button>
                </form>
            {% else %}
                <p><strong>Project completed âœ…</strong></p>
                {% if userProject.uploadedFilePath %}
                    <p>Uploaded file: <a href="{{ asset('uploads/project_files/' ~ userProject.uploadedFilePath) }}" target="_blank">Download</a></p>
                {% endif %}
            {% endif %}
        {% else %}
            {# Mostra bottone di registrazione se lutente non Ã¨ giÃ  registrato e non ha completato il progetto #}
            <form action="{{ path('project_register', { id: project.id }) }}" method="post">
                <button type="submit">Register</button>
            </form>
        {% endif %}
    {% else %}
        <p><a href="{{ path('app_login') }}">Login</a> to register for this project.</p>
    {% endif %}

    <p><a href="{{ path('project_list') }}">Back to list</a></p>
</div>
{% endblock %}
